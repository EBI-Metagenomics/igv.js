<script src="../dist/igv.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<div id="igv-div" style="float:left; width:80%;"">

</div>
<div id="igv-legend" style="float:right; width:20%;">
</div>
<style>
#igv-div {
    max-height: 20em;
}
#igv-legend {
    max-height:20em;
    overflow-y: scroll;
}
.legend-entry{
    clear:both;
    padding-bottom:0.5em;
}
.legend-color {
    height: 1em;
    width: 1em;
    margin-right:0.5em;
    float:left;
    clear:left;
}
</style>
<script type="text/javascript">
    function getLegendElem(key, color){
        const $legendEntry = $('<div class="legend-entry"></div>');
        const $color = $('<div class="legend-color" style="background:'+color+'"></div>');
        const $label = $('<div class="legend-label">'+key+'</div>');
        $legendEntry.append($color);
        $legendEntry.append($label);
        return $legendEntry;
    }
    function renderLegend(){
        const $legend = $('#igv-legend');
        $legend.empty();
        if (window.colorBy !== undefined){
            const legendData = window.colors[window.colorBy];       
            const $legendHeader = $('<h3>Legend</h3>');
            $legend.append($legendHeader);

            const keys = Object.keys(legendData).sort();
            for (var key of keys){
                if (legendData.hasOwnProperty(key)){
                    const $entry = getLegendElem(key, legendData[key]);
                    $legend.append($entry);
                }
            }
        }
    }
    var igvDiv = document.getElementById("igv-div");
    var options =
        {
            reference: {
                id: 'myid',
                fastaURL: "./MGYG-HGUT-01690.fna",
                indexURL: "./MGYG-HGUT-01690.fna.fai",
                index: true
            },
            tracks: [
                {
                    name: "GUT_GENOME_00001",
                    url: "./MGYG-HGUT-01690.gff",
                    format: "gff",
                    displayMode: "EXPANDED",
                    removable: false
                }
            ],
            color_fields: [
                'COG',
                'product',
                'Pfam',
                'KEGG',
                'InterPro',
                'eggNOG'
            ]
        };

    window.regen_legend=renderLegend;

    window.igv_config = options;
    igv.createBrowser(igvDiv, options)
    .then(function (browser) {
        console.log("Created IGV browser");
    })
</script>
